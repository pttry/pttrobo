---
title: "Kuviot"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{Kuviot}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE}
library(tidyverse)
library(pttdatahaku)
```

Kuvioiden piirtämiseksi pttropo- paketti sisältää aplot_ -alkuisia 
piirtofunktioita, joilla voidaan helposti piirtää kuvioita.

Kuvio-funktiot on tarkoitettut toimaan 'ptt_data_robo' -funktioiden kanssa, 
joissa päivämäärä muuttuja on time-sarakkeessa ja tiedot value-sarakkeessa.
Nämä on x ja y -oletussarakkeet, mutta ne voidaa myös muuttaa.

Muuttujat:

- x Oletus time
- y Oletus value
- colour Värien luokat
- size Koon luokat. Tarkoitus käyttää korostamiseen, joten ennaltamäärätyt koot, 
  jos diskreetti (ei toiminnassa vielä).
- title Otsikko
- subtitle Alaotsikko, käytettään myös y-akselin otsikkona. (Ei näy ?)
- source Lähde. Lisätään tekstiin: "Lähde: ..., PTT
- caption Vaihtoehto source:lle. Voidaan käyttää koko lähde-tekstin kirjoittamiseen.

## aplot_lines - perus viivakuvio

```{r, message=FALSE}

ptt_data_robo("StatFin/kan/vtp/statfin_vtp_pxt_11sf.px") |> 
  filter_recode(
     taloustoimi = c("Tuonti" = "P7R Tavaroiden ja palvelujen tuonti, tulona",
                     "Vienti" = "P6K Tavaroiden ja palvelujen vienti, menona"),
     tiedot = c("Volyymin muutokset, %")) |>
     aplot_lines(colour = taloustoimi,
                 title = "Vienti ja tuonti",
                 subtitle = "%, volyymin muutos",
                 source = "Tilastokeskus")

```
```{r}

ptt_data_robo("StatFin/kan/ntp/statfin_ntp_pxt_132h.px") |>
  filter_recode(
     taloustoimi = c("BKT" = "B1GMH Bruttokansantuote markkinahintaan",
                     "Yksityinen kulutus" = "P3KS14_S15 Yksityiset kulutusmenot, menona"),
     tiedot = c("Alkuperäinen sarja, viitevuosi 2015, miljoonaa euroa")) |>
     aplot_trends(colour = taloustoimi,
                 title = "Vienti ja tuonti",
                 subtitle = "%, volyymin muutos",
                 source = "Tilastokeskus")

```


```{r}

e <- readxl::read_excel(here::here("ptt_ennusteet_KT.xlsx")) |> dplyr::filter(stringr::str_detect(sarja, "B1GMH|P3KS14"))

ptt_data_robo("StatFin/kan/ntp/statfin_ntp_pxt_132h.px") |>
  filter_recode(
     taloustoimi = c("BKT" = "B1GMH Bruttokansantuote markkinahintaan",
                     "Yksityinen kulutus" = "P3KS14_S15 Yksityiset kulutusmenot, menona"),
     tiedot = c("Työpäiväkorjatun sarjan volyymin muutos vuodentakaisesta, %")) |>
  # mutate(value = value /100) |> 
  filter(time >= "2014-01-01") |>
  rename(sarjan_nimi = taloustoimi) |> 
     ptt_plot(grouping = sarjan_nimi, 
                 title = "Vienti ja tuonti",
                 subtitle = "%, volyymin muutos",
                 caption = "Tilastokeskus",
              rangeslider = F,height = 500) |> 
  ptt_plot_add_prediction_traces(e, with_labs = F)
```

```{r}

ptt_data_robo("StatFin/kan/ntp/statfin_ntp_pxt_132h.px") |>
  filter_recode(
     taloustoimi = c("BKT" = "B1GMH Bruttokansantuote markkinahintaan",
                     "Yksityinen kulutus" = "P3KS14_S15 Yksityiset kulutusmenot, menona"),
     tiedot = c(Alkuperäinen = "Työpäiväkorjatun sarjan volyymin muutos vuodentakaisesta, %",
                "Trendisarjan volyymin muutos vuodentakaisesta, %")) |>
  # mutate(value = value /100) |> 
  filter(time >= "2014-01-01") |>
  rename(sarjan_nimi = taloustoimi) |> 
     ptt_plot(grouping = sarjan_nimi, 
                 title = "Vienti ja tuonti",
                 subtitle = "%, volyymin muutos",
                 caption = "Tilastokeskus",
              rangeslider = F,height = 500, secondary_grouping = tiedot)

```


